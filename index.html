<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BetterAI Chatbot</title>
  <style>
    :root{--bg:#0f0f0f;--panel:#0b0b0b;--accent:#00aeff;--user:#00eaff;--ai:#72ff72;--muted:#9aa0a6}
    html,body{height:100%;margin:0}
    body {
      font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, Arial;
      background: linear-gradient(180deg,#060606 0%, #0f0f0f 100%);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      box-sizing: border-box;
    }
    .container{width:100%;max-width:900px;border-radius:12px;overflow:hidden;box-shadow:0 10px 30px rgba(0,0,0,0.6)}
    header{background:var(--panel);padding:14px 18px;display:flex;align-items:center;gap:12px}
    header h1{margin:0;font-size:18px}
    header p{margin:0;color:var(--muted);font-size:13px}
    .main{display:grid;grid-template-columns:1fr 320px;min-height:520px;background:#071018}

    .chat{padding:18px;display:flex;flex-direction:column;gap:12px}
    #chatbox{flex:1;overflow:auto;padding:10px;border-radius:8px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));}
    .msg{margin:8px 0;max-width:85%}
    .msg .who{font-weight:600;margin-bottom:4px}
    .msg.user{align-self:flex-end;text-align:right}
    .msg.user .bubble{background:linear-gradient(90deg,#05293b,#004b62);color:white;border-radius:12px;padding:10px}
    .msg.ai{align-self:flex-start}
    .msg.ai .bubble{background:linear-gradient(90deg,#082b07,#0a7f3a);color:black;border-radius:12px;padding:10px}

    .compose{display:flex;gap:8px;padding-top:8px}
    #input{flex:1;padding:12px;border-radius:10px;border:none;background:#0b1a1f;color:white;font-size:15px}
    #send-btn{background:var(--accent);border:none;padding:10px 14px;border-radius:10px;color:#001;font-weight:700;cursor:pointer}

    .panel{background:#061118;padding:12px;border-left:1px solid rgba(255,255,255,0.03);display:flex;flex-direction:column;gap:10px}
    .panel h3{margin:6px 0 0 0}
    .kv{display:flex;flex-direction:column;gap:6px}
    input.k, select.k{padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:white}
    button.ghost{padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:var(--muted);cursor:pointer}
    footer{padding:10px 14px;background:#020606;font-size:13px;color:var(--muted);text-align:center}

    @media(max-width:880px){.main{grid-template-columns:1fr} .panel{order:2}}
  </style>
</head>
<body>
  <div class="container" role="application">
    <header>
      <div style="display:flex;flex-direction:column">
        <h1>BetterAI <span style="font-size:12px;color:var(--muted);">(browser)</span></h1>
        <p>Paste your Groq API key in the right panel and press Save — then chat.</p>
      </div>
    </header>

    <div class="main">
      <div class="chat">
        <div id="chatbox" aria-live="polite"></div>

        <div class="compose">
          <input id="input" placeholder="Type your message... (press Enter to send)" autocomplete="off" />
          <button id="send-btn">Send</button>
        </div>
      </div>

      <aside class="panel">
        <h3>Settings</h3>
        <div class="kv">
          <label style="font-size:13px;color:var(--muted)">Groq API Key</label>
          <input id="api-key" class="k" placeholder="Paste key (starts with gsk_)" />
          <div style="display:flex;gap:8px">
            <button id="save-key" class="ghost">Save key</button>
            <button id="clear-key" class="ghost">Clear key</button>
          </div>
        </div>

        <div class="kv">
          <label style="font-size:13px;color:var(--muted)">Model</label>
          <select id="model" class="k">
            <option value="llama-3.3-70b-versatile">llama-3.3-70b-versatile</option>
            <option value="mixtral-instruct-8k">mixtral-instruct-8k</option>
          </select>
        </div>

        <div class="kv">
          <label style="font-size:13px;color:var(--muted)">Temperature</label>
          <input id="temp" class="k" type="number" min="0" max="1" step="0.1" value="0.2" />
        </div>

        <div style="margin-top:6px;color:var(--muted);font-size:13px">Status: <span id="status">No key saved</span></div>

        <div style="flex:1"></div>
        <div style="font-size:13px;color:var(--muted)">Tips: don't share your API key. This page stores it in your browser only.</div>
      </aside>
    </div>

    <footer>BetterAI — made for you.</footer>
  </div>

  <script>
    const chatbox = document.getElementById('chatbox');
    const input = document.getElementById('input');
    const sendBtn = document.getElementById('send-btn');
    const apiKeyInput = document.getElementById('api-key');
    const saveKeyBtn = document.getElementById('save-key');
    const clearKeyBtn = document.getElementById('clear-key');
    const statusEl = document.getElementById('status');
    const modelSelect = document.getElementById('model');
    const tempInput = document.getElementById('temp');

    const STORAGE_KEY = 'BETTERAI_GROQ_KEY_V1';
    const STORAGE_MODEL = 'BETTERAI_MODEL_V1';
    const STORAGE_TEMP = 'BETTERAI_TEMP_V1';

    const stored = localStorage.getItem(STORAGE_KEY);
    if (stored) { apiKeyInput.value = stored; statusEl.textContent = 'Key saved'; }

    const sm = localStorage.getItem(STORAGE_MODEL);
    if (sm) modelSelect.value = sm;

    const st = localStorage.getItem(STORAGE_TEMP);
    if (st) tempInput.value = st;

    saveKeyBtn.onclick = () => {
      const k = apiKeyInput.value.trim();
      if (!k) { alert('Paste your Groq key first'); return; }
      localStorage.setItem(STORAGE_KEY, k);
      localStorage.setItem(STORAGE_MODEL, modelSelect.value);
      localStorage.setItem(STORAGE_TEMP, tempInput.value);
      statusEl.textContent = 'Key saved';
      alert('API key saved. Ready to chat.');
    };

    clearKeyBtn.onclick = () => {
      localStorage.removeItem(STORAGE_KEY);
      apiKeyInput.value = '';
      statusEl.textContent = 'No key saved';
    };

    function appendMessage(role, text){
      const wrap = document.createElement('div');
      wrap.className = 'msg ' + (role==='user'?'user':'ai');
      const bubble = document.createElement('div');
      bubble.className = 'bubble';
      bubble.innerHTML = text.replace(/\n/g,'<br>');
      wrap.appendChild(bubble);
      chatbox.appendChild(wrap);
      chatbox.scrollTop = chatbox.scrollHeight;
    }

    async function sendMessage(){
      const text = input.value.trim();
      if (!text) return;
      appendMessage('user', text);
      input.value = '';

      const key = localStorage.getItem(STORAGE_KEY);
      if (!key) { alert('No API key saved.'); return; }

      const model = modelSelect.value;
      const temperature = parseFloat(tempInput.value) || 0.2;

      appendMessage('ai', '...');
      const lastBubble = chatbox.querySelector('.msg.ai:last-child .bubble');

      try {
        const resp = await fetch("https://api.groq.com/openai/v1/chat/completions", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer " + key
          },
          body: JSON.stringify({
            model,
            messages: [{ role: "user", content: text }],
            temperature,
            stream: true
          })
        });

        if (!resp.ok) {
          const err = await resp.text();
          lastBubble.innerText = "Error: " + resp.status + " — " + err;
          return;
        }

        const reader = resp.body.getReader();
        const decoder = new TextDecoder();
        let done = false;
        let accumulated = "";

        while (!done) {
          const { value, done: rdone } = await reader.read();
          done = rdone;
          if (value) {
            const chunk = decoder.decode(value);
            const parts = chunk.split("\n").filter(Boolean);

            for (const part of parts) {
              const line = part.trim();
              if (!line.startsWith("data:")) continue;

              const payload = line.replace(/^data:\s*/, "");
              if (payload === "[DONE]") break;

              try {
                const piece = JSON.parse(payload);
                const delta = piece.choices?.[0]?.delta?.content || "";
                if (delta) {
                  accumulated += delta;
                  lastBubble.innerHTML = accumulated.replace(/\n/g, "<br>");
                }
              } catch (e) {}
            }
          }
        }
      } catch (err) {
        lastBubble.innerText = "Network error: " + err.message;
      }
    }

    sendBtn.onclick = sendMessage;
    input.addEventListener("keydown", (e)=>{
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });

    appendMessage('ai','Hello! I\'m <b>BetterAI</b>. Paste your Groq API key and click Save.');
  </script>
</body>
</html>
